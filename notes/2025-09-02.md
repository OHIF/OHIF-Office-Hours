# OHIF Office Hours Notes 2025-08-19

## Q & A

attendees: 10



## One-line summaries

* ğŸ§­ Implement axis-specific display scaling (skew/non-uniform scale) in a viewport without breaking annotation/segmentation math.
* ğŸ§ª Switching NIfTI volumes after cache purging triggers a TypeError; whatâ€™s the correct purge/switch sequence?
* ğŸ§° DICOM JSON datasource shows only first frame and breaks in 3.9â€“3.11; is a fix planned and is DICOM JSON still supported?
* ğŸ–¼ï¸ Tools stop working on JPG/PNG after selecting an image type; is this a Cornerstone bug or app-level issue?
* ğŸŒˆ Efficiently toggle R/G/B channels for RGB images in CS3D without creating new vtkImageData.
* ğŸ§· Are intermittent segmentation save/load issues due to low bandwidth/Cloudflared, or a viewer rendering problem?


# Meeting Notes

ğŸ§­ **Scaling images along axes within a viewport (Cornerstone3D FR)**

* Scaling via camera affects all scene objects; proper solution requires modifying viewport transforms.
* Pixel spacing/metadata should not be altered (would break tools).
* Tools operate in world coordinates, so canvasâ†”world transforms must incorporate skew/scale.
* Debugging approach: log world coords on click, compare with another viewer (e.g., Slicer).
* Possible API addition: extend camera properties and adjust viewport transforms accordingly.

---

ğŸ§ª **NIfTI cache purging causes TypeError on switching volumes**

* Root cause: cache purge occurs while the first volume is still displayed.
* Workaround: blank viewport â†’ purge â†’ display new volume.
* Better approach: purge selectively by volume ID, not full purge.
* NIfTI loader is unstable; not a current priority.
* Contribution idea: PR for â€œpurge all except specified volumes.â€

---

ğŸ§° **DICOM JSON multi-frame images not loading (3.9â€“3.11)**

* Issue reproducible in official examples; only first frame loads.
* DICOM JSON datasource should be used (not DICOMweb).
* Multi-frames require frame numbers at the end of image IDs.
* Fixes expected in upcoming releases (3.12 planned, 3.11 recovery patch).
* Use `.scripts/dicom-json-generator.js` to generate proper JSON and share reproducible cases.
* DICOM JSON still supported but must be validated against the generator output.

---

ğŸ–¼ï¸ **JPG/PNG tools stop working after selecting image type**

* Need to isolate whether itâ€™s app-specific or a Cornerstone bug.
* Suggested test: reproduce with minimal Cornerstone stack example and reload button.
* If reproducible in core example â†’ bug in Cornerstone.
* If not reproducible â†’ issue in app logic.

---

ğŸŒˆ **Toggling RGB channels in viewport**

* Use browser-side SVG filter (`feColorMatrix`) to isolate channels.
* Example available in video viewport (color control).
* Efficient: no need to duplicate image data, operates on canvas level.
* Channel isolation matrix: set one channel to 1, others to 0, ensure last row includes `0 0 1 0`.

---

ğŸ§· **Segmentation not saved properly (OHIFâ€“Orthancâ€“Keycloak)**

* Not caused by bandwidth or Cloudflared tunnel. STOW rejects partial objects outright.
* Intermittent failures tied to rendering in 3D viewport (rehydration/hydration issue).
* Works consistently in 2D axial view; fails in 3D where label maps convert to surfaces.
* Next steps: file reproducible issues using viewer-dev.ohif.org, outside company-specific viewer.

