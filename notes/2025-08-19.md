# OHIF Office Hours Notes 2025-08-19

## Q & A

attendees: 10



## One-line summaries

* üåÄ Why does `VolumeViewport.setProperties` lose `interpolationType` depending on call order?
* üìä How to load only one DICOM SEG by its SeriesInstanceUID/SOPInstanceUID?
* üñºÔ∏è Can Cornerstone tools work with PNG/JPG/TIFF images, and how to enable measurements?
* üíæ Why aren‚Äôt segmentations/measurements saving in Orthanc when deployed with Nginx/Keycloak/Cloudflare Tunnel?
* üìå Is there time to review and merge specific open PRs in Cornerstone3D and OHIF?
* üß© How do URL parameters work for creating multiple display sets from one DICOM series?

----



### ‚úÖ **Questions and summarized answers**

üåÄ **Hi, I have a question regarding VolumeViewport.setProperties.**

When I try to set the interpolationType property and then later set another property (e.g., preset), the interpolationType setting is lost. For example:

```ts
viewport.setProperties(
  {
    interpolationType: Enums.InterpolationType.NEAREST,
  },
  volumeId,
);

viewport.setProperties(
  {
    preset: 'CT-Coronary-Arteries-3',
  },
  volumeId,
);
````

After this, interpolationType is no longer NEAREST.

I also tried merging the current properties with getProperties, but the issue still happens:

```ts
viewport.setProperties(
  {
    ...viewport.getProperties(volumeId),
    preset: 'CT-Coronary-Arteries-3',
  },
  volumeId,
);
```

Interestingly, if I reverse the order (set preset first and then interpolationType), it works fine.

Why does setProperties behave inconsistently depending on the order, and is there a correct way to persist interpolationType when updating multiple properties?

*There is an issue related to this already created: [https://github.com/cornerstonejs/cornerstone3D/issues/2276](https://github.com/cornerstonejs/cornerstone3D/issues/2276)*

* The team acknowledged this seems like a bug, especially since reversing the property-setting order avoids the issue.
* In the live session, they tried reproducing it using the **Volume API example** but couldn‚Äôt reproduce the error. They suggested it might be a race condition or related to the `volumeId` parameter handling.
* They recommended sharing a reproducible code example in the GitHub issue to help debug further.
* Example code from the session showing how interpolation can be set:

```ts
packages/core/examples/volumeAPI/index.ts

addButtonToToolbar({
 title: 'Set Interpolation',
 onClick: () => {
   // Get the rendering engine
   const renderingEngine = getRenderingEngine(renderingEngineId);

   // Get the stack viewport
   const viewport = renderingEngine.getViewport(
     viewportId
   ) as Types.IVolumeViewport;

   viewport.setProperties({
     interpolationType: Enums.InterpolationType.NEAREST,
   });
   viewport.render();
 },
});
```

---

üìä **I have a DICOM and multiple DICOM SEG related to this one. Is it possible to retrieve only one of these DICOM SEGs thanks to its SeriesInstanceUID/SOPInstanceUID?**

* By default, all SEGs for a study are listed, but they are only fully loaded when the user clicks them.
* To restrict loading to just one SEG, you can use the **`SeriesInstanceUID` filter** in the viewer URL.
* This way, only the SEG with that UID (and optionally its related image series) will load for the user.
* If multiple SEGs share the same `SeriesInstanceUID`, filtering can be trickier since OHIF doesn‚Äôt currently support finer-grained filters beyond `SeriesInstanceUID`.
* Docs and references:

  * [https://docs.ohif.org/configuration/url](https://docs.ohif.org/configuration/url)
  * Example:
    `https://viewer.ohif.org/viewer?StudyInstanceUIDs=1.3.6.1...&SeriesInstanceUIDs=1.3.6.1...`

---

üñºÔ∏è **Good day! ... I want specify we can with cornerstone tools with format png/jpg/tiff ? Because, i didn‚Äôt see examples. If no, how i can realize this feature?**

* Yes, you can load **PNG and JPG** images with Cornerstone3D, though **TIFF is not supported**.
* Tools like **zoom, pan, invert, and contrast** work on these image types. However:

  * Measurement tools (e.g., length, calibration in millimeters) don‚Äôt work directly since PNG/JPG lack DICOM metadata like pixel spacing.
  * To enable measurements, you need to **calibrate spacing manually** using the **Calibration Tools** example.
* Example command:

  ```bash
  yarn run example webloader
  ```
* Relevant resources:

  * [PR with loader updates](https://github.com/cornerstonejs/cornerstone3D/pull/2279)
  * [Calibration tools example](https://www.cornerstonejs.org/live-examples/calibrationtools)
  * `packages/tools/examples/calibrationTools/index.ts`

---

üíæ **I deployed the Nginx-Orthanc-Keycloak recipe via Cloudflare Tunnel. The system starts correctly in containers, but when I perform a segmentation or measurements in OHIF, they are not being saved. What configuration should I adjust to persist segmentations and measurements in Orthanc/OHIF?**

* Segmentations and measurements **are not saved automatically**. You must use the **save/export buttons** in OHIF.
* Saving generates **DICOM SR (Structured Reports)** for measurements and **DICOM SEG objects** for segmentations.
* These are then stored in Orthanc if properly configured.
* Possible issues:

  * **CORS (Cross-Origin Resource Sharing):** Saving involves POST requests, which may fail without correct CORS headers.

    * More info: [https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CORS/Errors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CORS/Errors)
  * **Keycloak authorization:** Ensure authentication tokens are passed through to Orthanc for DICOM store requests.
  * **Date format errors:** In the debug session, it was discovered that some DICOM metadata had incorrect date formats (`2002.04.01` instead of `20020401`). This caused save failures.
* Suggested actions:

  * Try the setup **without Cloudflare Tunnel** first to isolate the issue.
  * Validate Orthanc config supports DICOMWeb storage.
  * Inspect network requests in browser dev tools to confirm if failure is due to CORS, authorization, or invalid metadata.
* Helpful configs and code:

  * `APP_CONFIG=config/local_orthanc.js yarn run dev:fast`
  * [https://docs.ohif.org/deployment/user-account-control](https://docs.ohif.org/deployment/user-account-control)
  * `extensions/cornerstone-dicom-seg/src/commandsModule.ts` ‚Üí `storeSegmentation` function
  * Test data: [https://github.com/OHIF/viewer-testdata/tree/master/dcm](https://github.com/OHIF/viewer-testdata/tree/master/dcm)

---

üìå **Is there some time to review these PRs?**
[https://github.com/cornerstonejs/cornerstone3D/pull/2254](https://github.com/cornerstonejs/cornerstone3D/pull/2254)
[https://github.com/cornerstonejs/cornerstone3D/pull/2221](https://github.com/cornerstonejs/cornerstone3D/pull/2221)
And eventually:
[https://github.com/cornerstonejs/cornerstone3D/pull/2259](https://github.com/cornerstonejs/cornerstone3D/pull/2259)
[https://github.com/OHIF/Viewers/pull/5324](https://github.com/OHIF/Viewers/pull/5324)

* The team noted the PRs look good but haven‚Äôt been merged yet because **tests are missing**.
* Adding tests (unit or integration) for tools like Circle ROI would provide confidence that future changes won‚Äôt break functionality.
* Without tests, maintainers are hesitant to merge, even if the feature works locally.
* Example file mentioned for customization:
  `platform/ui-next/src/components/SegmentationTable/SegmentationExpanded.tsx`

---

üß© **When creating multiple displaysets from ONE series, how does the URL parameters work?**

Use Case: one series has 30 images, select first 10 ‚Üí create one display object, next 10 ‚Üí another, etc. How to switch between them?

* OHIF expects unique `SeriesInstanceUID` per display set, so splitting one series into multiple display sets is tricky.
* Current workaround:

  * Use the `SeriesInstanceUIDs` parameter with an **`initialSopInstanceUID`** to select a subset.
  * `initialSopInstanceUID` is not a filter, but a **hanging protocol selector** that lets you define which SOP instance to start with.
* Example project showing this in practice:

  * [https://github.com/eContour/OHIF](https://github.com/eContour/OHIF)
  * Example usage:
    [https://github.com/eContour/OHIF/blob/master/platform/app/src/App.tsx#L192](https://github.com/eContour/OHIF/blob/master/platform/app/src/App.tsx#L192)
* For embedded viewer in an iframe:

  * Use `postMessage` from the parent app to OHIF to switch display sets programmatically.
  * Internally, use React Router‚Äôs `useNavigate` to handle navigation between studies/series.
  * Reference implementation: [OHIF eContour project](https://github.com/eContour/OHIF).


