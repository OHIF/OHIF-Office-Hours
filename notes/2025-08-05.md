# OHIF Office Hours Notes 2025-08-05

## Q & A

attendees: 10


### One-line summaries
- üßÆ How to make labelmap statistics refresh optional due to UI freezing during updates?
- üñºÔ∏è Is it possible to restore the older MIP labelmap full volume visualization?
- üì± Can half-float rendering be enforced to address Android device limitations?
- ‚ö†Ô∏è SEG loading sometimes causes viewport to lose image and display properties‚Äîwhy?
- üñçÔ∏è How to adapt an annotation tool that uses CT metadata for CR images?
- üíæ What should be considered when overriding the default image cache size?
- üß© Is there any plan or timeline for vtk.js v34 upgrade in CS3D?
- üñºÔ∏è How to initialize the viewer in an iframe without a study/series loaded by default?


---


### ‚úÖ **Questions and summarized answers**


üßÆ **The labelmap implementation computes statistics in each labelmap update which create freezes in the interface. We think that it shouldn‚Äôt be forced to recompute statistics at each update as a use case may not need continuous refreshing of stats for each update and may prefer to compute stats only at the end of labelling effort. Could you guide us on how we can do a PR to make the refresh stats optional? File: setUpSegmentationEventHandlers.ts**

* Statistics computation is done in a worker thread, and shouldn't freeze the UI, but in some large datasets (e.g., PET-CTs), performance bottlenecks are noticed.
* Iterating over voxel data in 3D (X, Y, Z) is computationally expensive (O(n¬≥)); a planar iteration method (O(n¬≤)) could reduce processing time.
* Data transfer between threads could also be a source of delay.
* Currently, statistics are recomputed after a debounce of 1000ms following `segmentationDataModified`.
* For now, to disable statistics:

  * Locate and disable the `setupSegmentationDataModifiedHandler` in the segmentation extension.
  * You can increase the debounce delay from 1000ms to something higher for better performance.
  * It‚Äôs possible to make the event subscription conditional or expose a setting to enable/disable this feature.
* They're open to a PR that introduces this as an optional feature but haven‚Äôt committed to integrating it unless others report the same issue.

```ts
const { unsubscribe: unsubscribeSegmentationDataModifiedHandler } =
  setupSegmentationDataModifiedHandler({
    segmentationService,
    customizationService,
    commandsManager,
  });
```

---

üñºÔ∏è **For labelmap representation on MIP there is a EDGE blend parameter, which is fine but we want to display the full volume. When you were building the Segmentation mode 1y ago, we were happy with this display that is not available anymore. [https://www.youtube.com/shorts/hvHG8NGev\_0](https://www.youtube.com/shorts/hvHG8NGev_0) Is it possible to make this kind of visualisation available again?**

* The earlier visualization was likely a bug where outlines were deactivated and fill mode was activated.
* It's possible to reintroduce this behavior by:

  * Disabling outline and enabling fill.
  * Creating a new blend mode (e.g. ‚Äúno-outline‚Äù) if needed.
* Current blending has artifacts (e.g., incorrect color mixes), but some users are okay with unstable colors.
* Implementation suggestion:

  * Use VTK's blend modes.
  * Avoid integrated components for this type of rendering.
  * PR contributions are welcome to restore this behavior.

---

üì± **I am having the same issue described in [https://github.com/cornerstonejs/cornerstone3D/issues/2031](https://github.com/cornerstonejs/cornerstone3D/issues/2031) and [https://github.com/cornerstonejs/cornerstone3D/issues/2242](https://github.com/cornerstonejs/cornerstone3D/issues/2242). Since the problem arises for Android devices without floatLinear texture format support, I would like to know if there is a way of always enforcing half floats, i.e. halfFloat and halfFloatLinear**

* This issue affects Android devices lacking `OES_texture_float_linear`.
* No current way to force default to half-float rendering, though it was previously possible via the `preferSizeOverAccuracy` flag.
* Half-float has limited precision:

  * If pixel intensity exceeds 2048, multiple values map to the same grayscale.
  * Results in visual inaccuracies that can be unacceptable in clinical/research settings.
* Options suggested:

  * Use 32-bit float rendering if supported.
  * Use nearest-neighbor interpolation (`interpolationType = 0`) to show pixelated but visible output.

    * Set `interpolationType` on the viewport configuration.
  * Consider applying a post-processing filter (used in video rendering) for interpolation fallback.
* No reliable VTK utility exists to detect floatLinear support; a custom script can do this.

---

‚ö†Ô∏è **Did you noticed that loading a SEG in a HP sometimes make viewport losing original image and loosing display properties. It happens often but not every time, most of the time we can recover viewport on using the scroll or changing layout to reinstantiate viewport (but can loose segmentation representation also)**

* Yes, this issue is known.
* Sometimes the image goes black after loading SEG; recovery is possible but unreliable.
* Suggested action:

  * Create a reproducible scenario and open a GitHub issue.
  * They plan to investigate and add tests once reproducibility is confirmed.
  * A fix may come soon with more resources (team expansion).

---

üñçÔ∏è **I have an overlay tool (annotation tool) that works fine with CTs. It uses the imageOrientationPatient and frameOfReferenceUID. I wish to use the tool with CRs. What is the recommended approach to work around this?**

* CR images often lack required metadata like `frameOfReferenceUID`, `imageOrientationPatient`, and `imagePositionPatient`.
* Workaround:

  * Add a custom metadata provider that injects default values when missing.
  * The OHIF metadata provider does this internally as well.
* Example provided from OHIF (located in `dicomImageLoader/src/imageLoader/wadors/metaData/metaDataProvider.ts`):

```ts
if (!imagePositionPatient) {
  imagePositionPatient = [0, 0, 0];
  usingDefaultValues = true;
}
if (!imageOrientationPatient) {
  rowCosines = [1, 0, 0];
  columnCosines = [0, 1, 0];
  imageOrientationPatient = [...rowCosines, ...columnCosines];
}
```

---

üíæ **What considerations go into overriding the default cache size?**

* The default cache is \~3GB; increasing it is possible but risky.
* Considerations:

  * Browsers don‚Äôt warn when memory limits are exceeded‚Äîthey silently crash or unload.
  * No reliable API exists to query available memory due to anti-fingerprinting measures.
  * OHIF's cache usage is now more efficient.
* It‚Äôs generally safe to increase to 5GB; contributions to update the default to 5GB are welcome.
* Tips:

  * Monitor memory usage; store state in local storage.
  * Gradually increase cache only when needed (e.g., multiple studies).
  * Chromium has a 16GB hard limit.
  * The active viewport gets full cache; others only partially.
* Use `stackContextFreePatch` for better cache management.

---

üß© **Is there any work or timeline to upgrade vtk.js to v34.x in CS3D?**

* No timeline or specific plan mentioned for VTK.js v34 upgrade.

---

üñºÔ∏è **Is there a way to initialize the viewer without specifying study/series when embedding it in an iframe? E.g Say you open a study with one series, then you switch the viewport layout to 4. The three viewports are empty. How do you initialize the viewer with one viewport that has no image? In the URLs section of the docs, you have to specify a study at a minimum.**

* You must start with a study.
* Workaround: use hanging protocols.

  * Add `&hangingProtocolId=mpr` or other custom IDs to control layout.
  * You can define a custom hanging protocol with an empty state for unused viewports.
* The layout and display sets are controlled by the hanging protocol modules in each extension.

  * Example: MN Grid, HPMN, etc.
* These define rows, columns, and matching rules for what data to load in which viewport.

